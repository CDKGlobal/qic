package com.testing123.ui;

import org.json.JSONArray;
import org.json.JSONException;

import com.testing123.controller.UIState;
import com.testing123.dataObjects.ConvertDate;
import com.testing123.vaadin.GetData;
import com.testing123.vaadin.QueryDatabase;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.shared.ui.label.ContentMode;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.JavaScript;
import com.vaadin.ui.JavaScriptFunction;
import com.vaadin.ui.Label;
import com.vaadin.ui.Notification;

@SuppressWarnings("serial")
public class MainComponent extends CustomComponent {
	public static final String PANEL_WIDTH = QicUI.COMPONENT_WIDTH;
	public static final String PANEL_HEIGHT = QicUI.COMPONENT_HEIGHT;
	public static final String GRAPH_WIDTH = QicUI.GRAPH_WIDTH;
	public static final String GRAPH_HEIGHT = QicUI.GRAPH_HEIGHT;

	private AbsoluteLayout graph;
	private UIState state;
	private GetData data;
	
	/**
	 * The constructor should first build the main layout, set the
	 * composition root and then do any custom initialization.
	 *
	 * The constructor will not be automatically regenerated by the
	 * visual editor.
	 */
	public MainComponent(UIState state, GetData data) {
		this.state = state;
		this.data = data;
		buildMainLayout();
		setCompositionRoot(graph);
	}

	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		graph = new AbsoluteLayout();
		graph.setImmediate(false);
		graph.setWidth(PANEL_WIDTH);
		graph.setHeight(PANEL_HEIGHT);
		
		// top-level component properties
		setWidth(PANEL_WIDTH);
		setHeight(PANEL_HEIGHT);
		
		// Graph
		graph = buildGraph();
		return graph;
	}

	@AutoGenerated
	public AbsoluteLayout buildGraph() {		
		// common part: create layout
		graph = new AbsoluteLayout();
		graph.setImmediate(false);
		graph.setWidth(PANEL_WIDTH);
		graph.setHeight(PANEL_HEIGHT);
		
//		Label graphName = new Label("<b>" + state.getY() + " vs " + state.getX() + "</b>", ContentMode.HTML);
//		graphName.setStyleName("h2");
//		absoluteLayout_2.addComponent(graphName);
//		Label dateRange = new Label(state.getStart()
//				+ " to " + state.getEnd());
//		dateRange.setStyleName("p");
//		absoluteLayout_2.addComponent(dateRange, "top: 20px;");
		
		Graph chart = new Graph();
		chart.setWidth(GRAPH_WIDTH);
		chart.setHeight(GRAPH_HEIGHT);

		String d = data.requestData(state).toString();
		chart.setData(d);
		System.out.println(d);

		chart.setOptions(FlotOptions.getString(state));
		
		graph.addComponent(chart);
		return graph;
	}
}